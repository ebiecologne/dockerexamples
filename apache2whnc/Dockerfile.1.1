# Dockerfile for apache2whnc

FROM debian:stretch-slim

LABEL maintainer "oliver.eberlein@netcologne.de"

RUN echo "deb http://debian.netcologne.de/debian/ stretch main contrib non-free" > /etc/apt/sources.list
RUN echo "deb http://debian.netcologne.de/debian-security stretch/updates main contrib non-free" >> /etc/apt/sources.list

# install packages

RUN apt-get update

RUN apt-get install apt-utils aptitude -y locales net-tools procps git curl wget vim
RUN apt-get install -y apache2 libapache2-mod-fcgid apache2-suexec-custom
RUN apt-get install libnss-extrausers

RUN rm -rf /var/lib/apt/lists/* 
RUN localedef -i en_US -c -f UTF-8 -A /usr/share/locale/locale.alias en_US.UTF-8
ENV LANG en_US.utf8


# setup apache2

RUN rm /etc/apache2/sites-enabled/*
RUN /usr/sbin/a2ensite 000-default

ADD files/etc/apache2/conf-available /etc/apache2/conf-available
ADD files/etc/apache2/sites-available /etc/apache2/sites-available

# RUN /usr/sbin/a2enconf servername
RUN /usr/sbin/a2enconf apachelogs
RUN /usr/sbin/a2disconf other-vhosts-access-log
RUN /usr/sbin/a2enmod suexec

RUN chmod 755 /var/log/apache2

RUN /usr/sbin/a2enmod fcgid
ADD files/etc/apache2/mods-available/fcgid.conf /etc/apache2/mods-available/fcgid.conf

########################### php7.3 ###########################


ENV PHP_URL="https://secure.php.net/get/php-7.3.3.tar.xz/from/this/mirror"

RUN set -eux; \
	mkdir -p /usr/src/php73; \
	cd /usr/src; \
	wget -O php73.tar.xz "$PHP_URL"; \
    tar -Jxf /usr/src/php73.tar.xz -C /usr/src/php73 --strip-components=1




########################### php7.2 ###########################

ENV PHP_URL="https://secure.php.net/get/php-7.2.16.tar.xz/from/this/mirror"

RUN set -eux; \
	mkdir -p /usr/src/php72; \
	cd /usr/src; \
	wget -O php72.tar.xz "$PHP_URL"; \
    tar -Jxf /usr/src/php72.tar.xz -C /usr/src/php72 --strip-components=1



#ENTRYPOINT ["docker-php-entrypoint"]
##<autogenerated>##
#CMD ["php", "-a"]
##</autogenerated>##

CMD ["/usr/sbin/apache2ctl", "-D", "FOREGROUND"]

