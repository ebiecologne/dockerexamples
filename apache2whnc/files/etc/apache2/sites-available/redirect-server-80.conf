<VirtualHost    *:80>

 ServerName      websrv11.netcologne.de
 ServerAdmin     webmaster@netcologne.de
 DocumentRoot    /htdocs/error

 # LogFormat "%h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-Agent}i\" %T %V" redirect

 SetEnvIf Remote_Addr "127\.0\.0\.1" nolog
 SetEnvIf Remote_Addr "81\.173\.246\.2" nolog
 SetEnvIf Remote_Addr "81\.173\.246\.3" nolog

 SuexecUserGroup	#33 #10000

 # LogFormat "%{NCUSER}e %b" ncuser_traffic
 LogFormat "%h  %t %V %{DEST}e" redirect
 #LogFormat "%h %V" redirect
 # CustomLog       /var/log/apache2/redirect.log redirect env=!nolog

 DirectoryIndex index.html

 <Files ~ "^\.ht">
  Order allow,deny
  Deny from all
 </Files>

 <Directory /htdocs/error>
  AllowOverride None
  Options -Indexes
  order deny,allow
  allow from all
 </Directory>

 RewriteEngine          On
 # RewriteLog           /var/log/apache2/rewrite.log
 # RewriteLogLevel      3

 # "Nicht gefunden" als echten 404 zurückgeben und nicht als 301
 ErrorDocument  404     /notfound.html

 # Domains (nur letzte beiden Komponenten) mit oder ohne Pfad
 RewriteMap      domains                                         txt:/etc/apache2/redirect-server/redirects.txt
 
 # Regel für "ohne Pfad"
 RewriteCond     %{HTTP_HOST}                                    ([-a-zA-Z0-9]+\.[-a-zA-Z0-9]+)$
 RewriteCond     ${domains:%1/|NIX-GEFUNDEN}                     !=NIX-GEFUNDEN
 RewriteRule     ^/                                              ${domains:%1/} [E=DEST:${domains:%1/},R=301,L]
 
 # Regel für "mit Pfad"
 RewriteCond     %{HTTP_HOST}                                    ([-a-zA-Z0-9]+\.[-a-zA-Z0-9]+)$
 RewriteCond     ${domains:%1%{REQUEST_URI}|NIX-GEFUNDEN}        !=NIX-GEFUNDEN
 RewriteRule     ^/                                              ${domains:%1%{REQUEST_URI}}    [E=DEST:${domains:%1%{REQUEST_URI}},R=301,L]

 RewriteRule    ^/$             -       [R=404,L]
</VirtualHost>
